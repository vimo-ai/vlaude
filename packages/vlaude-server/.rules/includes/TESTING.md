### 测试通用规范（Vitest 优先）

#### 测试分类
- 单元（Unit）：
  - 目标：快速、稳定；无 I/O、无框架
  - 后端：Domain 层首选；使用纯函数/对象测试
  - 前端：组件内部逻辑与纯函数；组合函数
- 集成（Integration）：
  - 目标：验证模块间协作；可使用内存/测试替身
  - 后端：Application 层 + 内存仓储或测试数据库
  - 前端：组件与 API 层交互（使用 MSW 等）
- 端到端（E2E）：
  - 目标：模拟用户路径；覆盖关键业务流
  - 工具：supertest（后端 HTTP）、Playwright/Cypress（前端）

#### 运行与稳定性
- 一次性运行：`vitest --run`；禁止 watch/长驻
- 隔离：测试互不依赖、可并行；避免全局可变状态
- 固定种子与时间：对时间/随机使用注入或 mock

#### 测试数据与替身
- 固定 fixtures，清晰的构造器或工厂函数
- 对外部依赖（HTTP/ORM/存储）使用替身（mock/stub/fake）
- 数据库测试：专用测试库与清理策略（事务回滚/重置数据）

#### 断言与覆盖
- 断言聚焦行为与契约，不依赖内部实现细节
- 覆盖率门槛（建议）：Statements/Branches/Funcs/Lines ≥ 80%，关键路径更高

#### CI 与报告
- CI 中运行 typecheck + lint + tests；生成覆盖率报告
- 测试失败即刻阻断合并；禁止跳过失败测试
